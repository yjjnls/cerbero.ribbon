# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python
#from cerbero.tools.libtool import LibtoolLibrary

from cerbero.utils import shell

class Recipe(recipe.Recipe):
    name = 'libusrsctp'
    version = '1.0.0'
    remotes = {'origin': 'https://github.com/sctplab/usrsctp.git'}
    commit = '2f6478eb8d40f1766a96b5b033ed26c0c2244589'
    if os.getenv('MSYSTEM'):
        btype = BuildType.AUTOCMAKE
        
    else:
        btype = BuildType.CMAKE
        make = 'cmake --build .'

    patches = ['usrsctp/0001-AutoCmake-adaption.patch', 
               'usrsctp/0001-werror-maybe-uninitialized-fix.patch']
    
    files_libs = ['libusrsctp']
    files_devel = ['include/usrsctp.h', 'lib/pkgconfig/usrsctp.pc']

    def configure(self):
        if self.config.target_platform == Platform.LINUX:
            os.environ['CFLAGS'] += '-fPIC'
        super(recipe.Recipe, self).configure()

    def post_install(self):
        if self.config.target_platform == Platform.LINUX:
            shell.call('mv -f usrsctp.pc libusrsctp.pc', '%s/lib/pkgconfig/'%(self.config.install_dir))
