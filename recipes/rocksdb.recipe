# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python
#from cerbero.tools.libtool import LibtoolLibrary

import os

class Recipe(recipe.Recipe):
    name = 'rocksdb'
    version = '5.4.6'
    stype = SourceType.TARBALL
    if os.getenv('MSYSTEM'):
        btype = BuildType.AUTOCMAKE
        patches =['rocksdb/0001-AutoCMake-adaptation.patch']
    else:
        btype = BuildType.CMAKE
        configure_tpl = '%(config-sh)s . -G\"Unix Makefiles\" '\
                         '-DCMAKE_INSTALL_PREFIX=%(prefix)s '\
                         '-DCMAKE_LIBRARY_OUTPUT_PATH=%(libdir)s'


    #tarball_dirname = 'v%s'%version
    url = 'https://github.com/facebook/rocksdb/archive/v%s.tar.gz'%version
    #licenses = [License.GPL]
    files_libs  = ['librocksdb']
    files_devel = ['include/rocksdb','lib/pkgconfig/rocksdb.pc']
    files_tests = ['testkits/rocksdb']
    

    def prepare(self):
        if self.platform == Platform.WINDOWS:
            #self.make = 'msbuild.exe rocksdb.sln //p:Configuration=%s'%self.config.build_type
            self.configure_options = ' -DWITH_AVX2=OFF '



